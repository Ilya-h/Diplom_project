<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${movie.title}">Детали фильма</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" th:href="@{/}">Кинотеатр</a>
        <a th:href="@{/booking/movies}" class="btn btn-secondary">Назад к фильмам</a>
    </div>
</nav>

<div class="container mt-4">
    <div class="row">
        <div class="col-md-4">
            <!-- КОНТЕЙНЕР ДЛЯ ИЗОБРАЖЕНИЯ -->
            <div class="poster-container">
                <!-- Если есть изображение -->
                <img th:if="${movie.posterUrl != null and movie.posterUrl != ''}"
                     th:src="@{'/posters/' + ${movie.posterUrl}}"
                     class="movie-poster"
                     th:alt="${movie.title}"
                     onerror="showFallback(this)">

                <!-- Заглушка ТОЛЬКО если нет изображения -->
                <div th:if="${movie.posterUrl == null or movie.posterUrl == ''}"
                     class="no-poster">
                    <div th:text="${movie.title}"></div>
                </div>
            </div>
        </div>
        <div class="col-md-8">
            <h2 th:text="${movie.title}">Название фильма</h2>

            <div class="mt-3">
                <p><strong>Жанр:</strong> <span th:text="${movie.genre ?: 'Не указан'}">Жанр</span></p>
                <p><strong>Длительность:</strong>
                    <span th:text="${(movie.durationMinutes ?: 0) + ' минут'}">120 минут</span>
                </p>
                <p><strong>Режиссер:</strong> <span th:text="${movie.director ?: 'Не указан'}">Режиссер</span></p>
                <p><strong>Актеры:</strong> <span th:text="${movie.actors ?: 'Не указаны'}">Актеры</span></p>
                <p><strong>Возрастной рейтинг:</strong> <span th:text="${movie.ageRating ?: 'Не указан'}">16+</span></p>
                <p th:text="${movie.description ?: 'Описание отсутствует'}">Описание фильма...</p>
            </div>
        </div>
    </div>

    <div class="mt-5">
        <h3>Доступные сеансы</h3>

        <div th:if="${sessions == null or sessions.empty}" class="alert alert-info">
            На данный момент нет доступных сеансов для этого фильма.
        </div>

        <div th:each="movieSession : ${sessions}" th:if="${sessions != null and not sessions.empty}" class="card mb-2">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-3">
                        <h5 th:text="${movieSession.startTime != null ? #temporals.format(movieSession.startTime, 'dd.MM.yyyy') : 'Дата не указана'}">
                            01.01.2023
                        </h5>
                        <h4 th:text="${movieSession.startTime != null ? #temporals.format(movieSession.startTime, 'HH:mm') : 'Время не указано'}">
                            18:00
                        </h4>
                    </div>
                    <div class="col-md-3">
                        <p class="mb-1"><strong>Зал:</strong> <span th:text="${movieSession.hall?.name ?: 'Не указан'}">Зал 1</span></p>
                        <p class="mb-1"><strong>Формат:</strong> <span th:text="${movieSession.format ?: 'Не указан'}">2D</span></p>
                    </div>
                    <div class="col-md-3">
                        <p class="mb-1"><strong>Цена:</strong>
                            <span th:text="${#numbers.formatDecimal(movieSession.price ?: 0, 0, 2)} + ' ₽'">500 ₽</span>
                        </p>
                    </div>
                    <div class="col-md-3">
                        <a th:href="@{/booking/sessions/{id}(id=${movieSession.id})}"
                           class="btn btn-primary">Выбрать места</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>