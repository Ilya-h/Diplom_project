<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–í—ã–±–æ—Ä –º–µ—Å—Ç</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .seat {
            width: 40px;
            height: 40px;
            margin: 2px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 5px;
            user-select: none;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.2s;
            position: relative;
        }
        .available {
            background-color: #28a745;
            color: white;
            border: 1px solid #1e7e34;
        }
        .selected {
            background-color: #007bff;
            color: white;
            border: 2px solid #0056b3;
            transform: scale(1.1);
            box-shadow: 0 0 10px #007bff;
        }
        .occupied {
            background-color: #dc3545;
            color: white;
            cursor: not-allowed;
            opacity: 0.9;
            border: 2px solid #bd2130;
            position: relative;
        }
        .occupied:after {
            content: "‚úó";
            position: absolute;
            font-size: 20px;
            color: white;
            text-shadow: 0 0 3px rgba(0,0,0,0.5);
        }
        .vip {
            background-color: #ffc107;
            color: black;
            border: 2px solid #ff9800;
            font-weight: bold;
        }
        .couple {
            background-color: #e83e8c;
            color: white;
            border: 2px solid #c2185b;
        }
        .disabled {
            background-color: #6c757d;
            color: white;
            border: 2px dashed #495057;
            cursor: pointer;
        }
        .screen {
            background: linear-gradient(to bottom, #444, #222);
            color: white;
            text-align: center;
            padding: 20px;
            margin: 20px 0 40px 0;
            border-radius: 8px;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            border: 3px solid #333;
        }
        .seat:hover:not(.occupied) {
            opacity: 0.9;
            transform: scale(1.05);
        }
        .seat.occupied:hover {
            cursor: not-allowed;
            transform: none;
        }
        .row-label {
            width: 80px;
            font-weight: bold;
            text-align: center;
            color: #333;
            font-size: 15px;
            background-color: #f8f9fa;
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #dee2e6;
        }
        .seats-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 5px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .seats-list {
            display: flex;
            flex-wrap: nowrap;
            gap: 4px;
            flex-grow: 1;
            justify-content: center;
            min-height: 44px;
        }
        .legend-box {
            background-color: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .price-display {
            background-color: #e7f3ff;
            border-left: 5px solid #007bff;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .order-summary {
            position: sticky;
            top: 20px;
            background: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .occupied-vip {
            background: linear-gradient(135deg, #dc3545 50%, #ffc107 50%);
            color: white;
            border: 2px solid #bd2130;
        }
        .occupied-couple {
            background: linear-gradient(135deg, #dc3545 50%, #e83e8c 50%);
            color: white;
            border: 2px solid #bd2130;
        }
        .occupied-disabled {
            background: linear-gradient(135deg, #dc3545 50%, #6c757d 50%);
            color: white;
            border: 2px dashed #bd2130;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" th:href="@{/}">–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä</a>
    </div>
</nav>

<div class="container mt-4">
    <h2 class="mb-4">–í—ã–±–æ—Ä –º–µ—Å—Ç</h2>

    <!-- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —É—Å–ø–µ—à–Ω–æ–π –ø–æ–∫—É–ø–∫–µ -->
    <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
        <strong>–£—Å–ø–µ—à–Ω–æ!</strong> <span th:text="${successMessage}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <div class="card mb-4 shadow">
        <div class="card-body">
            <h4 th:text="${movieSession?.movie?.title ?: '–§–∏–ª—å–º'}" class="text-primary"></h4>
            <div class="row">
                <div class="col-md-6">
                    <p><strong>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:</strong><br>
                        <span th:if="${movieSession?.startTime != null}"
                              th:text="${#temporals.format(movieSession.startTime, 'dd.MM.yyyy HH:mm')}"
                              class="fw-bold"></span>
                        <span th:unless="${movieSession?.startTime != null}" class="fw-bold">–ù–µ —É–∫–∞–∑–∞–Ω–æ</span>
                    </p>
                    <p><strong>–ó–∞–ª:</strong> <span th:text="${movieSession?.hall?.name ?: '–ù–µ —É–∫–∞–∑–∞–Ω'}" class="fw-bold"></span></p>
                </div>
                <div class="col-md-6">
                    <p><strong>–§–æ—Ä–º–∞—Ç:</strong> <span th:text="${movieSession?.format ?: '–ù–µ —É–∫–∞–∑–∞–Ω'}" class="fw-bold"></span></p>
                    <p><strong>–¶–µ–Ω–∞ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç):</strong>
                        <span id="base-price" th:text="${#numbers.formatDecimal(250, 0, 2)} + ' ‚ÇΩ'"
                              class="fw-bold text-success"></span>
                    </p>
                </div>
            </div>

            <div class="price-display mt-3">
                <strong class="text-primary">–¶–µ–Ω—ã –ø–æ —Ç–∏–ø–∞–º –º–µ—Å—Ç:</strong><br>
                ‚Ä¢ –°—Ç–∞–Ω–¥–∞—Ä—Ç: <span th:text="${#numbers.formatDecimal(250, 0, 2)} + ' ‚ÇΩ'"></span><br>
                ‚Ä¢ VIP: <span th:text="${#numbers.formatDecimal(650, 0, 2)} + ' ‚ÇΩ'" class="text-warning"></span><br>
                ‚Ä¢ –ü–∞—Ä–Ω—ã–µ: <span th:text="${#numbers.formatDecimal(950, 0, 2)} + ' ‚ÇΩ'" class="text-danger"></span><br>
                ‚Ä¢ –î–ª—è –∏–Ω–≤–∞–ª–∏–¥–æ–≤: <strong>–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</strong>
            </div>
        </div>
    </div>

    <div class="text-center screen mb-5">
        üé¨ –≠–ö–†–ê–ù üé¨
    </div>

    <!-- –§–û–†–ú–ê –°–†–ê–ó–£ –û–¢–ü–†–ê–í–õ–Ø–ï–¢–°–Ø –ù–ê /booking/sessions/{id}/payment -->
    <form method="post" th:action="@{/booking/sessions/{id}/payment(id=${movieSession?.id})}" id="booking-form">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

        <div class="mb-4" id="seats-container">
            <!-- –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –º–µ—Å—Ç–∞ -->
            <div th:if="${seatsByRow != null and not seatsByRow.isEmpty()}">
                <!-- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä—è–¥—ã —Å –º–µ—Å—Ç–∞–º–∏ -->
                <div th:each="rowEntry : ${seatsByRow}">
                    <div class="seats-row">
                        <div class="row-label" th:text="'–†—è–¥ ' + ${rowEntry.key}"></div>
                        <div class="seats-list">
                            <!-- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –º–µ—Å—Ç–∞ –≤ —Ç–µ–∫—É—â–µ–º —Ä—è–¥—É -->
                            <div th:each="seat : ${rowEntry.value}">
                                <!-- VIP –º–µ—Å—Ç–∞ -->
                                <div th:if="${seat.seatType == 'VIP'}">
                                    <div th:if="${seat.isAvailable}"
                                         class="seat vip"
                                         th:attr="data-id=${seat.seatId}, data-available=true,
                                                  data-seat-type=${seat.seatType}, data-row=${seat.rowNumber},
                                                  data-number=${seat.seatNumber}, data-price='650.00'"
                                         onclick="toggleSeat(this)"
                                         th:title="'VIP: –†—è–¥ ' + ${seat.rowNumber} + ', –ú–µ—Å—Ç–æ ' + ${seat.seatNumber}">
                                        <span th:text="${seat.seatNumber}"></span>
                                    </div>
                                    <div th:unless="${seat.isAvailable}"
                                         class="seat occupied occupied-vip"
                                         th:attr="data-id=${seat.seatId}, data-available=false,
                                                  data-seat-type=${seat.seatType}, data-row=${seat.rowNumber},
                                                  data-number=${seat.seatNumber}"
                                         th:title="'VIP: –†—è–¥ ' + ${seat.rowNumber} + ', –ú–µ—Å—Ç–æ ' + ${seat.seatNumber} + ' (–ó–ê–ù–Ø–¢–û)'">
                                        <span th:text="${seat.seatNumber}" style="opacity:0.7"></span>
                                    </div>
                                </div>

                                <!-- –ü–∞—Ä–Ω—ã–µ –º–µ—Å—Ç–∞ -->
                                <div th:if="${seat.seatType == 'COUPLE'}">
                                    <div th:if="${seat.isAvailable}"
                                         class="seat couple"
                                         th:attr="data-id=${seat.seatId}, data-available=true,
                                                  data-seat-type=${seat.seatType}, data-row=${seat.rowNumber},
                                                  data-number=${seat.seatNumber}, data-price='950.00'"
                                         onclick="toggleSeat(this)"
                                         th:title="'–ü–∞—Ä–Ω—ã–µ: –†—è–¥ ' + ${seat.rowNumber} + ', –ú–µ—Å—Ç–æ ' + ${seat.seatNumber}">
                                        <span th:text="${seat.seatNumber}"></span>
                                    </div>
                                    <div th:unless="${seat.isAvailable}"
                                         class="seat occupied occupied-couple"
                                         th:attr="data-id=${seat.seatId}, data-available=false,
                                                  data-seat-type=${seat.seatType}, data-row=${seat.rowNumber},
                                                  data-number=${seat.seatNumber}"
                                         th:title="'–ü–∞—Ä–Ω—ã–µ: –†—è–¥ ' + ${seat.rowNumber} + ', –ú–µ—Å—Ç–æ ' + ${seat.seatNumber} + ' (–ó–ê–ù–Ø–¢–û)'">
                                        <span th:text="${seat.seatNumber}" style="opacity:0.7"></span>
                                    </div>
                                </div>

                                <!-- –ú–µ—Å—Ç–∞ –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–æ–≤ -->
                                <div th:if="${seat.seatType == 'DISABLED'}">
                                    <div th:if="${seat.isAvailable}"
                                         class="seat disabled"
                                         th:attr="data-id=${seat.seatId}, data-available=true,
                                                  data-seat-type=${seat.seatType}, data-row=${seat.rowNumber},
                                                  data-number=${seat.seatNumber}, data-price='0.00'"
                                         onclick="toggleSeat(this)"
                                         th:title="'–î–ª—è –∏–Ω–≤–∞–ª–∏–¥–æ–≤: –†—è–¥ ' + ${seat.rowNumber} + ', –ú–µ—Å—Ç–æ ' + ${seat.seatNumber}">
                                        <span th:text="${seat.seatNumber}"></span>
                                    </div>
                                    <div th:unless="${seat.isAvailable}"
                                         class="seat occupied occupied-disabled"
                                         th:attr="data-id=${seat.seatId}, data-available=false,
                                                  data-seat-type=${seat.seatType}, data-row=${seat.rowNumber},
                                                  data-number=${seat.seatNumber}"
                                         th:title="'–î–ª—è –∏–Ω–≤–∞–ª–∏–¥–æ–≤: –†—è–¥ ' + ${seat.rowNumber} + ', –ú–µ—Å—Ç–æ ' + ${seat.seatNumber} + ' (–ó–ê–ù–Ø–¢–û)'">
                                        <span th:text="${seat.seatNumber}" style="opacity:0.7"></span>
                                    </div>
                                </div>

                                <!-- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ—Å—Ç–∞ (–≤–∫–ª—é—á–∞—è PREMIUM, –∫–æ—Ç–æ—Ä—ã–µ —Ç–æ–∂–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏) -->
                                <div th:if="${seat.seatType == 'STANDARD' or seat.seatType == 'PREMIUM' or seat.seatType == null}">
                                    <div th:if="${seat.isAvailable}"
                                         class="seat available"
                                         th:attr="data-id=${seat.seatId}, data-available=true,
                                                  data-seat-type='STANDARD', data-row=${seat.rowNumber},
                                                  data-number=${seat.seatNumber}, data-price='250.00'"
                                         onclick="toggleSeat(this)"
                                         th:title="'–°—Ç–∞–Ω–¥–∞—Ä—Ç: –†—è–¥ ' + ${seat.rowNumber} + ', –ú–µ—Å—Ç–æ ' + ${seat.seatNumber}">
                                        <span th:text="${seat.seatNumber}"></span>
                                    </div>
                                    <div th:unless="${seat.isAvailable}"
                                         class="seat occupied"
                                         th:attr="data-id=${seat.seatId}, data-available=false,
                                                  data-seat-type='STANDARD', data-row=${seat.rowNumber},
                                                  data-number=${seat.seatNumber}"
                                         th:title="'–°—Ç–∞–Ω–¥–∞—Ä—Ç: –†—è–¥ ' + ${seat.rowNumber} + ', –ú–µ—Å—Ç–æ ' + ${seat.seatNumber} + ' (–ó–ê–ù–Ø–¢–û)'">
                                        <span th:text="${seat.seatNumber}" style="opacity:0.7"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div th:unless="${seatsByRow != null and not seatsByRow.isEmpty()}" class="alert alert-warning text-center">
                <h5>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Å—Ç</h5>
                <p>–í –¥–∞–Ω–Ω–æ–º –∑–∞–ª–µ –Ω–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–µ—Å—Ç –∏–ª–∏ –≤—Å–µ –º–µ—Å—Ç–∞ —É–∂–µ –∑–∞–Ω—è—Ç—ã.</p>
                <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π —Å–µ–∞–Ω—Å –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.</p>
            </div>
        </div>

        <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö -->
        <input type="hidden" name="selectedSeatIds" id="selectedSeatIds" value="">
        <input type="hidden" name="totalPrice" id="totalPrice" value="0">
        <input type="hidden" name="selectedSeatsCount" id="selectedSeatsCount" value="0">

        <div class="row mt-5">
            <div class="col-md-6">
                <div class="legend-box shadow">
                    <h5 class="mb-3">–õ–µ–≥–µ–Ω–¥–∞ –º–µ—Å—Ç:</h5>
                    <div class="row">
                        <div class="col-6">
                            <div class="d-flex align-items-center mb-3">
                                <div class="seat available me-3"></div>
                                <span>–°–≤–æ–±–æ–¥–Ω–æ (250 ‚ÇΩ)</span>
                            </div>
                            <div class="d-flex align-items-center mb-3">
                                <div class="seat selected me-3"></div>
                                <span>–í—ã–±—Ä–∞–Ω–æ</span>
                            </div>
                            <div class="d-flex align-items-center mb-3">
                                <div class="seat occupied me-3"></div>
                                <span>–ó–∞–Ω—è—Ç–æ</span>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="d-flex align-items-center mb-3">
                                <div class="seat vip me-3"></div>
                                <span class="fw-bold">VIP (650 ‚ÇΩ)</span>
                            </div>
                            <div class="d-flex align-items-center mb-3">
                                <div class="seat couple me-3"></div>
                                <span>–ü–∞—Ä–Ω—ã–µ (950 ‚ÇΩ)</span>
                            </div>
                            <div class="d-flex align-items-center mb-3">
                                <div class="seat disabled me-3"></div>
                                <span>–î–ª—è –∏–Ω–≤–∞–ª–∏–¥–æ–≤ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)</span>
                            </div>
                        </div>
                    </div>
                    <div class="alert alert-info mt-3">
                        <small><strong>–°—Ö–µ–º–∞ –∑–∞–ª–∞ (–ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è):</strong><br>
                            ‚Ä¢ –†—è–¥—ã 1-2: VIP –º–µ—Å—Ç–∞ (–ø–µ—Ä–≤—ã–µ 3 –º–µ—Å—Ç–∞)<br>
                            ‚Ä¢ –†—è–¥—ã 3-7: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ—Å—Ç–∞ (–≤–∫–ª—é—á–∞—è —Ä—è–¥—ã 4-6)<br>
                            ‚Ä¢ –†—è–¥—ã 8-9: –ø–∞—Ä–Ω—ã–µ –º–µ—Å—Ç–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –º–µ—Å—Ç–∞)<br>
                            ‚Ä¢ –†—è–¥ 9: –º–µ—Å—Ç–∞ –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–æ–≤ (–ø–µ—Ä–≤–æ–µ –∏ –ø–æ—Å–ª–µ–¥–Ω–µ–µ)</small>
                    </div>
                    <div class="alert alert-warning mt-2">
                        <small><strong>‚ö† –í–∞–∂–Ω–æ:</strong> –ú–µ—Å—Ç–∞ –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏</small>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card shadow order-summary">
                    <div class="card-body">
                        <h5 class="mb-3">–í–∞—à –∑–∞–∫–∞–∑:</h5>

                        <!-- –°–≤–æ–¥–∫–∞ –∑–∞–∫–∞–∑–∞ -->
                        <div class="mb-4">
                            <div class="d-flex justify-content-between mb-2">
                                <span>–í—ã–±—Ä–∞–Ω–æ –º–µ—Å—Ç:</span>
                                <strong><span id="selected-count" class="text-primary">0</span></strong>
                            </div>
                            <div class="d-flex justify-content-between mb-3">
                                <span>–û–±—â–∞—è —Å—É–º–º–∞:</span>
                                <strong><span id="total-price-display" class="text-success fs-5">0.00</span> ‚ÇΩ</strong>
                            </div>
                        </div>

                        <!-- –°–ø–∏—Å–æ–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –º–µ—Å—Ç -->
                        <div id="selected-seats-list" class="mb-4">
                            <strong class="mb-2 d-block">–í—ã–±—Ä–∞–Ω–Ω—ã–µ –º–µ—Å—Ç–∞:</strong>
                            <div id="selected-seats-names" class="text-muted small">
                                <em>–ù–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –º–µ—Å—Ç</em>
                            </div>
                        </div>

                        <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã -->
                        <button type="submit" class="btn btn-success btn-lg py-3 w-100 mb-3" id="submit-btn" disabled>
                            <span id="submit-text">–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ</span>
                        </button>

                        <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã -->
                        <a th:href="@{/booking/movies}" class="btn btn-outline-secondary py-3 w-100">
                            –û—Ç–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
    const selectedSeats = [];
    const seatInfo = {};

    function toggleSeat(element) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –≤—ã–±—Ä–∞—Ç—å —ç—Ç–æ –º–µ—Å—Ç–æ
        const isAvailable = element.getAttribute('data-available') === 'true';

        if (!isAvailable) {
            alert('–≠—Ç–æ –º–µ—Å—Ç–æ —É–∂–µ –∑–∞–Ω—è—Ç–æ! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–µ –º–µ—Å—Ç–æ.');
            return;
        }

        const seatId = element.getAttribute('data-id');
        const seatType = element.getAttribute('data-seat-type');
        const row = element.getAttribute('data-row');
        const number = element.getAttribute('data-number');

        const index = selectedSeats.indexOf(seatId);

        if (index > -1) {
            // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ
            selectedSeats.splice(index, 1);
            delete seatInfo[seatId];

            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–ª–∞—Å—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –º–µ—Å—Ç–∞
            element.classList.remove('selected');
            if (seatType === 'VIP') {
                element.classList.add('vip');
            } else if (seatType === 'COUPLE') {
                element.classList.add('couple');
            } else if (seatType === 'DISABLED') {
                element.classList.add('disabled');
            } else {
                element.classList.add('available');
            }
        } else {
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ
            selectedSeats.push(seatId);

            // –ü–æ–ª—É—á–∞–µ–º —Ü–µ–Ω—É –º–µ—Å—Ç–∞ (–∏–∑ data-price)
            let price = parseFloat(element.getAttribute('data-price')) || 0;

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            seatInfo[seatId] = {
                row: row,
                number: number,
                type: seatType,
                price: price,
                isAvailable: isAvailable
            };

            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º
            element.classList.remove('available', 'vip', 'couple', 'disabled');
            element.classList.add('selected');
        }

        updateDisplay();
    }

    function getTypeName(seatType) {
        const names = {
            'STANDARD': '–°—Ç–∞–Ω–¥–∞—Ä—Ç',
            'VIP': 'VIP',
            'COUPLE': '–ü–∞—Ä–Ω—ã–µ',
            'DISABLED': '–î–ª—è –∏–Ω–≤–∞–ª–∏–¥–æ–≤'
        };
        return names[seatType] || '–°—Ç–∞–Ω–¥–∞—Ä—Ç'; // –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º "–°—Ç–∞–Ω–¥–∞—Ä—Ç" –¥–ª—è –ª—é–±—ã—Ö –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤
    }

    function updateDisplay() {
        // –°—á–∏—Ç–∞–µ–º –æ–±—â—É—é —Å—É–º–º—É
        let total = 0;
        selectedSeats.forEach(id => {
            total += seatInfo[id]?.price || 0;
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –∏ —Å—É–º–º—É –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
        document.getElementById('selected-count').textContent = selectedSeats.length;
        document.getElementById('total-price-display').textContent = total.toFixed(2);

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –º–µ—Å—Ç
        const listElement = document.getElementById('selected-seats-names');
        if (selectedSeats.length > 0) {
            let html = '';
            selectedSeats.forEach(id => {
                const info = seatInfo[id];
                if (info) {
                    const priceText = info.price === 0 ? '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ' : info.price.toFixed(2) + ' ‚ÇΩ';
                    html += `<div class="mb-2 p-2 border rounded bg-light">
                                <div class="d-flex justify-content-between">
                                    <strong>–†—è–¥ ${info.row}, –ú–µ—Å—Ç–æ ${info.number}</strong>
                                    <span class="text-success">${priceText}</span>
                                </div>
                                <div class="text-muted small">${getTypeName(info.type)}</div>
                             </div>`;
                }
            });
            listElement.innerHTML = html;
        } else {
            listElement.innerHTML = '<div class="text-center p-3"><em class="text-muted">–ù–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –º–µ—Å—Ç</em></div>';
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É
        const btn = document.getElementById('submit-btn');
        const btnText = document.getElementById('submit-text');
        const hasSeats = selectedSeats.length > 0;

        btn.disabled = !hasSeats;

        if (hasSeats) {
            btnText.textContent = `–û–ø–ª–∞—Ç–∏—Ç—å ${total.toFixed(2)} ‚ÇΩ`;
            btn.classList.remove('btn-primary');
            btn.classList.add('btn-success');
        } else {
            btnText.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–∞';
            btn.classList.remove('btn-success');
            btn.classList.add('btn-primary');
        }

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Å–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã
        document.getElementById('selectedSeatIds').value = selectedSeats.join(',');
        document.getElementById('totalPrice').value = total.toFixed(2);
        document.getElementById('selectedSeatsCount').value = selectedSeats.length;
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', function() {
        updateDisplay();

        // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –ø–æ–∫—É–ø–∫–µ, –æ–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–Ω—è—Ç—ã—Ö –º–µ—Å—Ç
        const successAlert = document.querySelector('.alert-success');
        if (successAlert) {
            // –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É
            // –ù–∞–ø—Ä–∏–º–µ—Ä, –æ–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ—Å—Ç —á–µ—Ä–µ–∑ AJAX
        }
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
    document.getElementById('booking-form').addEventListener('submit', function(e) {
        if (selectedSeats.length === 0) {
            e.preventDefault();
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –º–µ—Å—Ç–æ!');
            return false;
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –º–µ—Å—Ç–∞ –≤—Å–µ –µ—â–µ –¥–æ—Å—Ç—É–ø–Ω—ã
        let allAvailable = true;
        const unavailableSeats = [];

        selectedSeats.forEach(seatId => {
            const seatElement = document.querySelector(`.seat[data-id="${seatId}"]`);
            if (seatElement) {
                const isAvailable = seatElement.getAttribute('data-available') === 'true';
                if (!isAvailable) {
                    allAvailable = false;
                    unavailableSeats.push(seatId);
                }
            }
        });

        if (!allAvailable) {
            e.preventDefault();
            alert('–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –º–µ—Å—Ç–∞ —Å—Ç–∞–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ –≤—ã–±–æ—Ä.');

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–Ω–∏–º–∞–µ–º –≤—ã–±–æ—Ä —Å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Å—Ç
            unavailableSeats.forEach(seatId => {
                const index = selectedSeats.indexOf(seatId);
                if (index > -1) {
                    selectedSeats.splice(index, 1);
                    delete seatInfo[seatId];

                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∏–ª—å –º–µ—Å—Ç–∞
                    const seatElement = document.querySelector(`.seat[data-id="${seatId}"]`);
                    if (seatElement) {
                        seatElement.classList.remove('selected');
                        const seatType = seatElement.getAttribute('data-seat-type');
                        if (seatType === 'VIP') {
                            seatElement.classList.add('vip');
                        } else if (seatType === 'COUPLE') {
                            seatElement.classList.add('couple');
                        } else if (seatType === 'DISABLED') {
                            seatElement.classList.add('disabled');
                        } else {
                            seatElement.classList.add('available');
                        }
                    }
                }
            });

            updateDisplay();
            return false;
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ –æ–ø–ª–∞—Ç–µ
        const btn = document.getElementById('submit-btn');
        btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>–ü–µ—Ä–µ—Ö–æ–¥ –∫ –æ–ø–ª–∞—Ç–µ...';
        btn.disabled = true;

        // –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º
        return true;
    });
</script>

<!-- –î–æ–±–∞–≤–ª—è–µ–º Bootstrap JS –¥–ª—è —Ä–∞–±–æ—Ç—ã alert -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>