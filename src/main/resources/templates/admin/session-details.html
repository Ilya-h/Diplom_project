<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Детали сеанса</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .debug-info {
            background-color: #f8f9fa;
            border-left: 4px solid #dc3545;
            padding: 15px;
            margin-bottom: 20px;
        }
        .session-details .card {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .session-details .card-header {
            background-color: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }
         /* Стили для постера */
        .movie-poster-container {
            height: 500px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin-bottom: 20px;
        }

        .movie-poster {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .movie-poster:hover {
            transform: scale(1.05);
        }

        .no-poster {
            height: 100%;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .no-poster-icon {
            font-size: 72px;
            margin-bottom: 20px;
            opacity: 0.8;
        }

        .no-poster-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .no-poster-text {
            font-size: 16px;
            opacity: 0.9;
        }

        .movie-info {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 25px;
            height: 100%;
        }

        .info-label {
            font-weight: 600;
            color: #495057;
            min-width: 140px;
        }

        .info-value {
            color: #212529;
        }

        .movie-title {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" th:href="@{/admin/dashboard}">Кинотеатр Админ</a>
        <a th:href="@{/admin/sessions}" class="btn btn-secondary">Назад к сеансам</a>
    </div>
</nav>
<div class="container mt-4">

    <!-- Основной контент -->
    <h2 class="mb-4">Детали сеанса</h2>

    <!-- Сообщение об ошибке -->
    <div th:if="${error}" class="alert alert-danger">
        <strong>Ошибка!</strong> <span th:text="${error}"></span>
    </div>

    <!-- Если сеанс найден -->
    <div th:if="${session != null}">
        <div class="session-details">
            <!-- Информация о сеансе -->
            <div class="card mb-4">
                <div class="card-header">
                    <h4>Информация о сеансе</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>ID сеанса:</strong>
                                <span th:text="${debugId ?: session.id}">-</span>
                            </p>
                            <p><strong>Дата и время:</strong>
                                <span th:text="${formattedStartTime ?: session.startTime}">-</span>
                            </p>
                            <p><strong>Цена билета:</strong>
                                <span th:text="${debugPrice ?: session.price}">-</span> руб.
                            </p>
                            <p><strong>Формат:</strong>
                                <span th:text="${debugFormat ?: session.format}">-</span>
                            </p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Зал:</strong>
                                <span th:text="${hallName ?: session.hall?.name ?: 'Не указан'}">-</span>
                            </p>
                            <p><strong>Вместимость зала:</strong>
                                <span th:text="${hallCapacity ?: session.hall?.capacity}">-</span> мест
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Если сеанс не найден -->
    <div th:unless="${session != null}" class="alert alert-warning">
        <p>Сеанс не найден или произошла ошибка при загрузке данных.</p>
        <a th:href="@{/admin/sessions}" class="btn btn-secondary">
            Вернуться к списку сеансов
        </a>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Функция для форматирования даты
    function formatDateTime(dateTimeStr) {
        if (!dateTimeStr) return '';
        try {
            const date = new Date(dateTimeStr);
            return date.toLocaleString('ru-RU', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        } catch (e) {
            return dateTimeStr;
        }
    }

    // Форматируем дату, если есть элемент с классом .format-date
    document.addEventListener('DOMContentLoaded', function() {
        const dateElement = document.querySelector('[data-date-time]');
        if (dateElement && dateElement.textContent.trim()) {
            const formattedDate = formatDateTime(dateElement.textContent.trim());
            if (formattedDate) {
                dateElement.textContent = formattedDate;
            }
        }
    });

    // Функция для отображения заглушки при ошибке загрузки изображения
    function showFallback(imgElement) {
        imgElement.style.display = 'none';
        const container = imgElement.parentElement;
        const fallback = container.querySelector('.no-poster-fallback');
        if (fallback) {
            fallback.style.display = 'flex';
        }
    }
</script>
</body>
</html>