<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title th:text="${movie.title}">Детали фильма</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .movie-poster-container {
        height: 500px;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        margin-bottom: 20px;
    }

    .movie-poster {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .movie-poster:hover {
        transform: scale(1.05);
    }

    .no-poster {
        height: 100%;
        background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white;
        padding: 20px;
        text-align: center;
    }

    .no-poster-icon {
        font-size: 72px;
        margin-bottom: 20px;
        opacity: 0.8;
    }

    .no-poster-title {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 10px;
    }

    .no-poster-text {
        font-size: 16px;
        opacity: 0.9;
    }

    .movie-info {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 25px;
        height: 100%;
    }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand" th:href="@{/admin/dashboard}">Кинотеатр Админ</a>
    <a th:href="@{/admin/movies}" class="btn btn-secondary">Назад к фильмам</a>
  </div>
</nav>

<div class="container mt-4">
  <div class="row">
    <!-- Левая колонка - постер -->
    <div class="col-md-4">
      <div class="movie-poster-container">
        <!-- Если есть изображение -->
        <img th:if="${movie.posterUrl != null and movie.posterUrl != ''}"
             th:src="@{'/posters/' + ${movie.posterUrl}}"
             class="movie-poster"
             th:alt="${movie.title}"
             onerror="showFallback(this)">

        <!-- Заглушка ТОЛЬКО если нет изображения -->
        <div th:if="${movie.posterUrl == null or movie.posterUrl == ''}"
             class="no-poster">
          <div th:text="${movie.title}"></div>
        </div>
      </div>
    </div> <!-- ЗАКРЫВАЮЩИЙ ДИВ ДЛЯ ЛЕВОЙ КОЛОНКИ -->

    <!-- Правая колонка - информация -->
    <div class="col-md-8">
      <div class="movie-info">
        <h2 th:text="${movie.title}" class="text-primary">Название фильма</h2>

        <div class="mt-3">
          <p><strong>ID:</strong> <span th:text="${movie.id}" class="badge bg-info">1</span></p>
          <p><strong>Жанр:</strong> <span th:text="${movie.genre ?: 'Не указан'}">Жанр</span></p>
          <p><strong>Длительность:</strong>
            <span th:text="${(movie.durationMinutes ?: 0) + ' минут'}" class="fw-bold">120 минут</span>
          </p>
          <p><strong>Режиссер:</strong> <span th:text="${movie.director ?: 'Не указан'}">Режиссер</span></p>
          <p><strong>Актеры:</strong> <span th:text="${movie.actors ?: 'Не указаны'}">Актеры</span></p>
          <p><strong>Возрастной рейтинг:</strong>
            <span th:text="${movie.ageRating ?: 'Не указан'}" class="badge bg-warning">16+</span>
          </p>
          <p><strong>Дата выхода:</strong>
            <span th:text="${movie.releaseDate != null ? #temporals.format(movie.releaseDate, 'dd.MM.yyyy') : 'Не указана'}"
                  class="fw-bold">01.01.2023</span>
          </p>
          <hr>
          <p><strong>Описание:</strong></p>
          <p th:text="${movie.description ?: 'Описание отсутствует'}" class="lead">
            Описание фильма...
          </p>
        </div>

        <!-- Кнопки админа -->
        <div class="mt-4">
          <a th:href="@{/admin/movies/{id}/edit(id=${movie.id})}"
             class="btn btn-warning">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil me-1" viewBox="0 0 16 16">
              <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325"/>
            </svg>
            Редактировать
          </a>

          <form th:action="@{/admin/movies/{id}/delete(id=${movie.id})}"
                method="post"
                class="d-inline ms-2">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <button type="submit"
                    class="btn btn-danger"
                    th:onclick="'return confirm(\'Удалить фильм \\'' + ${movie.title} + '\\'? Все связанные сеансы также будут удалены!\')'">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash me-1" viewBox="0 0 16 16">
                <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
              </svg>
              Удалить фильм
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Таблица сеансов -->
  <div class="card mt-4">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">Сеансы этого фильма</h5>
    </div>
    <div class="card-body">
      <table class="table table-hover" th:if="${sessions != null and not #lists.isEmpty(sessions)}">
        <thead>
        <tr>
          <th>ID</th>
          <th>Дата и время</th>
          <th>Зал</th>
          <th>Цена</th>
          <th>Формат</th>
          <th>Действия</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="movieSession : ${sessions}">
          <td th:text="${movieSession.id}">1</td>
          <td th:text="${movieSession.startTime != null ? #temporals.format(movieSession.startTime, 'dd.MM.yyyy HH:mm') : 'Не указано'}">
            01.01.2023 18:00
          </td>
          <td th:text="${movieSession.hall?.name ?: 'Не указан'}">Зал 1</td>
          <td>
            <span th:text="${#numbers.formatDecimal(movieSession.price != null ? movieSession.price : 0, 0, 2)} + ' ₽'">
              500 ₽
            </span>
          </td>
          <td th:text="${movieSession.format ?: 'Не указан'}">2D</td>
          <td>
            <a th:href="@{/admin/sessions/{id}(id=${movieSession.id})}"
               class="btn btn-sm btn-info">Просмотр</a>
          </td>
        </tr>
        </tbody>
      </table>

      <div th:if="${sessions == null or #lists.isEmpty(sessions)}" class="alert alert-info">
        Нет запланированных сеансов для этого фильма.
        <a th:href="@{/admin/sessions/new}" class="alert-link">Создать сеанс</a>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>